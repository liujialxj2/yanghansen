---
import { getAposData } from '../lib/apos-api.js';
import MainLayout from '../layouts/MainLayout.astro';
import templates from '../templates/index.js';
import i18next, { t } from 'i18next';
import { Trans } from 'astro-i18next/components';
import { localizePath } from 'astro-i18next';
import '../lib/i18n-init.js';

export const prerender = false;

// 获取路径
const { slug } = Astro.params;
const path = '/' + (slug || '');

// 获取 ApostropheCMS 数据
const aposData = await getAposData({
  req: Astro.request,
  slug: slug || 'index'
});

const { page, notFound } = aposData;

// 404处理
if (notFound || !page) {
  return Astro.redirect('/404');
}

// 确定使用哪个模板
const templateType = page.type;

// 获取对应的模板组件
const Template = templates[templateType];

// 如果没有找到对应的模板组件，返回404
if (!Template) {
  console.error(`No template found for type: ${templateType}`);
  return Astro.redirect('/404');
}

// 准备页面标题
const pageTitle = page.title;
const siteTitle = 'Hansen Yang | 杨瀚森官方网站';
const fullTitle = `${pageTitle} - ${siteTitle}`;
---

<MainLayout title={fullTitle} page={page}>
  <Template aposData={aposData} />
</MainLayout>
