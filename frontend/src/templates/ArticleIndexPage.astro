---
import { t } from "i18next";
import AposArea from '@apostrophecms/apostrophe-astro/components/AposArea.astro';
import dayjs from 'dayjs';

const { aposData } = Astro.props;
const { page, pieces, pager } = aposData;
---

<div class="articles-page">
  <section class="hero is-dark">
    <div class="hero-body">
      <div class="container">
        <h1 class="title is-2">{page.title}</h1>
          </div>
        </div>
  </section>
  
  <section class="section">
    <div class="container">
      <AposArea area={page.beforeIndex} />
      
      <div class="articles">
        <div class="columns is-multiline">
          {pieces.map(article => (
            <div class="column is-4">
              <div class="card article-card">
                {article.thumbnail && (
                  <div class="card-image">
                    <figure class="image is-3by2">
                      <img 
                        src={article.thumbnail._url} 
                        alt={article.title} 
                        loading="lazy" 
                      />
                    </figure>
                  </div>
                )}
                <div class="card-content">
                  <p class="article-date">
                    {dayjs(article.publicationDate).format('YYYY.MM.DD')}
                  </p>
                  <h3 class="article-title">
                    <a href={article._url}>{article.title}</a>
                  </h3>
                  <p class="article-author">{article.authorName}</p>
                </div>
                <div class="card-footer">
                  <a href={article._url} class="card-footer-item">
                    {t("article.readMore")}
                    <span class="icon"><i class="fas fa-chevron-right"></i></span>
                  </a>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- 分页 -->
      {pager && pager.pages > 1 && (
        <nav class="pagination is-centered mt-6" role="navigation" aria-label="pagination">
          {pager.page > 1 && (
            <a href={pager.previous} class="pagination-previous">
              <span class="icon"><i class="fas fa-chevron-left"></i></span>
              上一页
            </a>
    )}

          {pager.page < pager.pages && (
            <a href={pager.next} class="pagination-next">
              下一页
              <span class="icon"><i class="fas fa-chevron-right"></i></span>
            </a>
          )}
          
          <ul class="pagination-list">
            {Array.from({ length: pager.pages }, (_, i) => (
              <li>
                <a 
                  href={`${pager.url}?page=${i + 1}`} 
                  class={`pagination-link ${pager.page === i + 1 ? 'is-current' : ''}`}
                  aria-label={`转到第 ${i + 1} 页`}
                  aria-current={pager.page === i + 1 ? 'page' : undefined}
                >
                  {i + 1}
                </a>
              </li>
            ))}
          </ul>
        </nav>
  )}
      
      <AposArea area={page.afterIndex} />
  </div>
</section>
</div>

<style>
  .hero {
    background-color: #101010;
  }
  
  .articles {
    margin: 3rem 0;
  }
  
  .article-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .card-content {
    flex-grow: 1;
    padding: 1.5rem;
}

  .article-date {
    font-size: 0.9rem;
    color: #E03A3E;
    margin-bottom: 0.5rem;
  }
  
  .article-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    line-height: 1.4;
  }
  
  .article-title a {
    color: #f5f5f5;
    transition: color 0.2s ease;
  }
  
  .article-title a:hover {
    color: #E03A3E;
}

  .article-author {
    font-size: 0.9rem;
    color: #888;
  }
  
  .card-footer-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #f5f5f5;
  }
  
  .card-footer-item:hover {
    background-color: rgba(224, 58, 62, 0.1);
    color: #E03A3E;
  }
  
  /* 分页样式 */
  .pagination-link.is-current {
    background-color: #E03A3E;
    border-color: #E03A3E;
}
  
  .pagination-previous,
  .pagination-next,
  .pagination-link {
    background-color: #1A1A1A;
    border-color: #333;
    color: #f5f5f5;
}

  .pagination-previous:hover,
  .pagination-next:hover,
  .pagination-link:hover {
    border-color: #E03A3E;
}
</style>